<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>åˆ†æ 7zip æ¼æ´ CVE-2024-11147(WIP) | PwnTips</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="åˆ†æ 7zip æ¼æ´ CVE-2024-11147(WIP)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="åˆ†æä¸€ä¸‹ 7zip æ¼æ´ CVE-2024-11477/ZDI-24-1532ï¼ŒæŸ¥çœ‹ ZDI å…¬å‘Š æå–åˆ°å…³é”®ç‚¹ï¼š 24.07 ä¿®å¤ï¼Œä¹‹å‰çš„ç‰ˆæœ¬æœ‰é—®é¢˜ï¼šé‚£ä¹ˆæˆ‘ä»¬ DIFF 24.07 å’Œ 24.06 çš„ä»£ç  æ¼æ´å‡ºç°åœ¨ Zstandard è§£å‹çš„ä»£ç ä¸­" />
<meta property="og:description" content="åˆ†æä¸€ä¸‹ 7zip æ¼æ´ CVE-2024-11477/ZDI-24-1532ï¼ŒæŸ¥çœ‹ ZDI å…¬å‘Š æå–åˆ°å…³é”®ç‚¹ï¼š 24.07 ä¿®å¤ï¼Œä¹‹å‰çš„ç‰ˆæœ¬æœ‰é—®é¢˜ï¼šé‚£ä¹ˆæˆ‘ä»¬ DIFF 24.07 å’Œ 24.06 çš„ä»£ç  æ¼æ´å‡ºç°åœ¨ Zstandard è§£å‹çš„ä»£ç ä¸­" />
<link rel="canonical" href="https://pwntips.github.io/2024/12/10/7zip-CVE-2024-11477.html" />
<meta property="og:url" content="https://pwntips.github.io/2024/12/10/7zip-CVE-2024-11477.html" />
<meta property="og:site_name" content="PwnTips" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-12-10T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="åˆ†æ 7zip æ¼æ´ CVE-2024-11147(WIP)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-10T00:00:00+08:00","datePublished":"2024-12-10T00:00:00+08:00","description":"åˆ†æä¸€ä¸‹ 7zip æ¼æ´ CVE-2024-11477/ZDI-24-1532ï¼ŒæŸ¥çœ‹ ZDI å…¬å‘Š æå–åˆ°å…³é”®ç‚¹ï¼š 24.07 ä¿®å¤ï¼Œä¹‹å‰çš„ç‰ˆæœ¬æœ‰é—®é¢˜ï¼šé‚£ä¹ˆæˆ‘ä»¬ DIFF 24.07 å’Œ 24.06 çš„ä»£ç  æ¼æ´å‡ºç°åœ¨ Zstandard è§£å‹çš„ä»£ç ä¸­","headline":"åˆ†æ 7zip æ¼æ´ CVE-2024-11147(WIP)","mainEntityOfPage":{"@type":"WebPage","@id":"https://pwntips.github.io/2024/12/10/7zip-CVE-2024-11477.html"},"url":"https://pwntips.github.io/2024/12/10/7zip-CVE-2024-11477.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://pwntips.github.io/feed.xml" title="PwnTips" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-LDS6Z1TT65"></script>
<script>
  window['ga-disable-G-LDS6Z1TT65'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
  window.dataLayer = window.dataLayer || [];
  function gtag(){window.dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LDS6Z1TT65');
</script>

</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">PwnTips</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">åˆ†æ 7zip æ¼æ´ CVE-2024-11147(WIP)</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-12-10T00:00:00+08:00" itemprop="datePublished">
        Dec 10, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>åˆ†æä¸€ä¸‹ 7zip æ¼æ´ CVE-2024-11477/ZDI-24-1532ï¼ŒæŸ¥çœ‹ <a href="https://www.zerodayinitiative.com/advisories/ZDI-24-1532/">ZDI å…¬å‘Š</a> æå–åˆ°å…³é”®ç‚¹ï¼š</p>
<ul>
  <li>24.07 ä¿®å¤ï¼Œä¹‹å‰çš„ç‰ˆæœ¬æœ‰é—®é¢˜ï¼šé‚£ä¹ˆæˆ‘ä»¬ DIFF 24.07 å’Œ 24.06 çš„ä»£ç </li>
  <li>æ¼æ´å‡ºç°åœ¨ <a href="https://en.wikipedia.org/wiki/Zstd">Zstandard</a> è§£å‹çš„ä»£ç ä¸­</li>
</ul>

<p>DIFF</p>

<p><a href="https://sourceforge.net/projects/sevenzip/files/7-Zip/24.06/7z2406-src.7z/download">2406</a>
<a href="https://sourceforge.net/projects/sevenzip/files/7-Zip/24.07/7z2407-src.7z/download">2407</a></p>

<p>ç”¨ beyond compare å¯¹æ¯”ä»¥åæ‰¾åˆ° C\ZstdDec.c è¿™ä¸ªæ–‡ä»¶æœ‰å¦‚ä¸‹ä¿®æ”¹:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">&gt;&gt;</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="nx">diff</span><span class="w"> </span><span class="nx">D:\Downloads\7z-compare\2406\C\ZstdDec.c</span><span class="w"> </span><span class="nx">D:\Downloads\7z-compare\2407\C\ZstdDec.c</span><span class="w">
</span><span class="n">diff</span><span class="w"> </span><span class="nt">--git</span><span class="w"> </span><span class="s2">"a/D:\\Downloads\\7z-compare\\2406\\C\\ZstdDec.c"</span><span class="w"> </span><span class="s2">"b/D:\\Downloads\\7z-compare\\2407\\C\\ZstdDec.c"</span><span class="w">
</span><span class="n">index</span><span class="w"> </span><span class="nx">fd0dbda..ef9eca3</span><span class="w"> </span><span class="nx">100644</span><span class="w">
</span><span class="o">---</span><span class="w"> </span><span class="s2">"a/D:\\Downloads\\7z-compare\\2406\\C\\ZstdDec.c"</span><span class="w">
</span><span class="o">+++</span><span class="w"> </span><span class="s2">"b/D:\\Downloads\\7z-compare\\2407\\C\\ZstdDec.c"</span><span class="w">
</span><span class="err">@@</span><span class="w"> </span><span class="nt">-1</span><span class="p">,</span><span class="mi">5</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w"> </span><span class="err">@@</span><span class="w">
 </span><span class="n">/</span><span class="o">*</span><span class="w"> </span><span class="nx">ZstdDec.c</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="nx">Zstd</span><span class="w"> </span><span class="nx">Decoder</span><span class="w">
</span><span class="nt">-2024-05-26</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="nx">was</span><span class="w"> </span><span class="nx">developed</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">Igor</span><span class="w"> </span><span class="nx">Pavlov</span><span class="p">,</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">Zstandard</span><span class="w"> </span><span class="nx">format</span><span class="w">
</span><span class="o">+</span><span class="mi">2024</span><span class="nt">-06-18</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="nx">was</span><span class="w"> </span><span class="nx">developed</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">Igor</span><span class="w"> </span><span class="nx">Pavlov</span><span class="p">,</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">Zstandard</span><span class="w"> </span><span class="nx">format</span><span class="w">
              </span><span class="n">specification</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="nx">zstd</span><span class="w"> </span><span class="nx">decoder</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="nx">as</span><span class="w"> </span><span class="nx">reference</span><span class="w"> </span><span class="nx">code.</span><span class="w">
 </span><span class="n">original</span><span class="w"> </span><span class="nx">zstd</span><span class="w"> </span><span class="nx">decoder</span><span class="w"> </span><span class="nx">code:</span><span class="w"> </span><span class="nx">Copyright</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="n">Facebook</span><span class="p">,</span><span class="w"> </span><span class="nx">Inc.</span><span class="w"> </span><span class="nx">All</span><span class="w"> </span><span class="nx">rights</span><span class="w"> </span><span class="nx">reserved.</span><span class="w">
 </span><span class="n">This</span><span class="w"> </span><span class="nx">source</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">licensed</span><span class="w"> </span><span class="nx">under</span><span class="w"> </span><span class="nx">BSD</span><span class="w"> </span><span class="nx">3-Clause</span><span class="w"> </span><span class="nx">License.</span><span class="w">
</span><span class="err">@@</span><span class="w"> </span><span class="nt">-1308</span><span class="p">,</span><span class="mi">8</span><span class="w"> </span><span class="o">+</span><span class="mi">1308</span><span class="p">,</span><span class="mi">10</span><span class="w"> </span><span class="err">@@</span><span class="w"> </span><span class="n">FSE_Decode_SeqTable</span><span class="p">(</span><span class="n">CFseRecord</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">const</span><span class="w"> </span><span class="nx">table</span><span class="p">,</span><span class="w">
   </span><span class="n">in-</span><span class="err">&gt;</span><span class="nx">len--</span><span class="p">;</span><span class="w">
   </span><span class="p">{</span><span class="w">
     </span><span class="n">const</span><span class="w"> </span><span class="nx">Byte</span><span class="w"> </span><span class="o">*</span><span class="nx">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in-</span><span class="err">&gt;</span><span class="nx">ptr</span><span class="p">;</span><span class="w">
</span><span class="o">-</span><span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="nx">Byte</span><span class="w"> </span><span class="nx">sym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w">
</span><span class="o">+</span><span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="nx">unsigned</span><span class="w"> </span><span class="nx">sym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w">
     </span><span class="n">in-</span><span class="err">&gt;</span><span class="nx">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">1</span><span class="p">;</span><span class="w">
</span><span class="o">+</span><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">sym</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="w"> </span><span class="n">numSymbolsMax</span><span class="p">)</span><span class="w">
</span><span class="o">+</span><span class="w">      </span><span class="kr">return</span><span class="w"> </span><span class="n">SZ_ERROR_DATA</span><span class="p">;</span><span class="w">
     </span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">FastInt32</span><span class="p">)</span><span class="n">sym</span><span class="w">
       </span><span class="c">#if defined(Z7_ZSTD_DEC_USE_ML_PLUS3)</span><span class="w">
         </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">numSymbolsMax</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NUM_ML_SYMBOLS</span><span class="w"> </span><span class="nf">?</span><span class="w"> </span><span class="nx">MATCH_LEN_MIN</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">0</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>æ ¹æ®è¿™ä¸ªä¿®æ”¹æˆ‘ä»¬å¯ä»¥å¤§èƒ†æ¨æµ‹ï¼Œè¿™é‡Œæ˜¯ä»å­—èŠ‚æµä¸­è¯»å‡º 1 å­—èŠ‚çš„æŸä¸ªç»“æ„çš„æ•°é‡ï¼Œä¹‹å‰æ²¡æœ‰éªŒè¯è¿™ä¸ªæ•°é‡æ˜¯å¦è¶…å‡ºäº†æ­£å¸¸çš„èŒƒå›´ï¼Œæ‰€ä»¥äº§ç”Ÿäº†æ¼æ´ã€‚
æ¥ä¸‹æ¥æˆ‘ä»¬è¦éªŒè¯è¿™ä¸ªçš„çŒœæµ‹ï¼Œå¹¶ä¸”æ„é€ ä¸€ä¸ª POC å‡ºæ¥ã€‚</p>

<p>å…ˆè¦äº†è§£ä¸€ä¸‹ .zst æ–‡ä»¶æ ¼å¼çš„ä¿¡æ¯ï¼Œå¯ä»¥æœåˆ°ä¸€ä¸ª facebook å®˜æ–¹çš„<a href="https://github.com/facebook/zstd/blob/dev/doc/zstd_compression_format.md">æ–‡æ¡£</a> ï¼Œé˜…è¯»åå¾—çŸ¥ï¼š</p>
<ul>
  <li>.zst æ–‡ä»¶æ˜¯ç”±å¤šä¸ª frame ç»„æˆçš„, frame ä»¥é­”æ³•æ•° 0xFD2FB528 å¼€å¤´</li>
  <li>æ¯ä¸ª frame å¯ä»¥åŒ…å« 1-n ä¸ª data_blockï¼Œdata_block æœ‰å¤šç§ç±»å‹ï¼Œå‚¨å­˜å‹ç¼©æ•°æ®çš„æ˜¯ Compressed_Block</li>
  <li>Compressed_Block åŒ…å« Literals Section å’Œ Sequence Section ä¸¤éƒ¨åˆ†</li>
</ul>

<p>å†æ¥ç»“åˆä»£ç ï¼Œè¢«ä¿®æ”¹çš„å‡½æ•°æ˜¯ <code class="language-plaintext highlighter-rouge">FSE_Decode_SeqTable</code>, ä»…åœ¨ <code class="language-plaintext highlighter-rouge">ZstdDec1_DecodeBlock</code> å‡½æ•°ä¸­æœ‰ 3 å¤„å¼•ç”¨ï¼Œä¸”è¿™ä¸‰å¤„å¼•ç”¨ç›¸é‚»ï¼Œåº”è¯¥æ˜¯è§£ç  data_block çš„ä¸€ä¸ªæ­¥éª¤ã€‚ç»“åˆæ–‡æ¡£åˆ†æä»£ç ï¼Œå‘ç°å‡½æ•° <code class="language-plaintext highlighter-rouge">ZstdDec1_DecodeBlock</code>  å®é™…ä¸Šåœ¨å¤„ç† Compressed_Blockï¼Œå‡½æ•° <code class="language-plaintext highlighter-rouge">FSE_Decode_SeqTable</code> åœ¨å¤„ç† Sequences Section, è¢«ä¿®æ”¹çš„ä»£ç è¡Œï¼Œæ˜¯åœ¨è§£ç  Compressed_mode ä¸º RLE_Mode çš„ sequence æ•°æ®ï¼Œè¯»åˆ° <code class="language-plaintext highlighter-rouge">sym</code> å˜é‡çš„å€¼æ˜¯ Literals_Length_Table/Offset_Table/Match_Length_Table çš„å†…å®¹ï¼Œæ˜¯æ”»å‡»è€…å¯æ§çš„ï¼Œ<code class="language-plaintext highlighter-rouge">table[0] = sym</code> æ˜¯å°†å…¶ä¿å­˜åˆ°äº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">CZstdDecFseTables</code> ç»“æ„ä½“ï¼Œä»¥ä¾›åç»­ä½¿ç”¨ã€‚æ¥ä¸‹æ¥åˆ†æè¿™ä¸ªå€¼åœ¨å“ªé‡Œä½¿ç”¨ï¼Œç›®å‰é«˜åº¦æ€€ç–‘æ˜¯åé¢ç´§æ¥ç€ä¼šè°ƒç”¨çš„ <code class="language-plaintext highlighter-rouge">Decompress_Sequences</code> å‡½æ•°ä¸­ï¼Œä½†æ˜¯æ­¤å‡½æ•°ç”¨äº†å¤§é‡çš„å®ï¼Œç›´æ¥åˆ†æèµ·æ¥å¾ˆä¸æ–¹ä¾¿ï¼Œå…ˆç”¨ VC ç¼–è¯‘å™¨çš„åŠŸèƒ½å¾—åˆ°ä¸€ä»½é¢„å¤„ç†ä¹‹åçš„ä»£ç </p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">&gt;</span><span class="w"> </span><span class="c"># Visual Studio Developer Powershell ä¸­è¿è¡Œï¼Œå¦åˆ™å¯èƒ½æŠ¥é”™æ²¡æ‰¾åˆ° cl</span><span class="w">
</span><span class="err">&gt;</span><span class="w"> </span><span class="n">cl</span><span class="w"> </span><span class="nx">/P</span><span class="w"> </span><span class="nx">c\ZstdDec.c</span><span class="w"> 
</span><span class="err">&gt;</span><span class="w"> </span><span class="c"># å¯é€‰æ­¥éª¤ï¼Œåªæ˜¯æ ¼å¼åŒ–ä»£ç ï¼Œå¦‚æœè£… VS æ—¶å€™æ²¡æœ‰é€‰è£… llvm å¯èƒ½ä¼šç¼ºå°‘ clang-format</span><span class="w">
</span><span class="err">&gt;</span><span class="w"> </span><span class="n">clang-format</span><span class="w"> </span><span class="nx">ZstdDec.i</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">ZstdDec.i.c</span><span class="w"> 
</span></code></pre></div></div>

<p>é˜…è¯»ä»¥åå°±å¯ä»¥è¯å®ï¼Œå­˜å…¥ <code class="language-plaintext highlighter-rouge">CZstdDecFseTables</code> çš„å€¼ï¼Œå°±æ˜¯åœ¨ <code class="language-plaintext highlighter-rouge">Decompress_Sequences</code> ä¸­ä½¿ç”¨çš„ï¼ŒDecompress_Sequences æ˜¯ tANS/FSE è§£ç ç®—æ³•çš„å®ç°ï¼Œè¿™ä¸ªç®—æ³•æ˜¯ zstd å‹ç¼©ç‡èƒ½é«˜ä¸å…¶ä»–ä»…åŸºäº huffman ç¼–ç çš„å‹ç¼©è½¯ä»¶çš„æ ¸å¿ƒå› ç´ ï¼Œæˆ‘è®¤ä¸ºè¿˜æ¯”è¾ƒå¤æ‚ï¼Œä¸è¿‡å¯¹äºæˆ‘ä»¬æ¼æ´åˆ†æçš„ç›®æ ‡æ¥è¯´ï¼Œä¹Ÿä¸éœ€è¦äº†è§£å¾ˆå¤šï¼Œå‚è€ƒ <a href="https://medium.com/@bredelet/understanding-ans-coding-through-examples-d1bebfc7e076">understanding-ans-coding-through-examples-d1bebfc7e076</a> å¯ä»¥å¾—åˆ°è§£ç çš„æ“ä½œé‡ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
  <li>è§£ç éœ€è¦ä¸‰ä¸ªè¾“å…¥å‚æ•°ï¼šçŠ¶æ€ xã€é€ŸæŸ¥è¡¨ tableã€å­—èŠ‚æµ bitStream</li>
  <li>é€ŸæŸ¥è¡¨å­˜å‚¨äº†æ¯ä¸ªçŠ¶æ€å¯¹åº”çš„ï¼šç¬¦å· S, ä»¥åŠçŠ¶æ€è½¬ç§»éœ€è¦çš„å‚æ•° yã€kï¼ˆä½¿ç”¨æ–¹å¼ä¾‹å¦‚ table[x].Sã€table[x].yã€table[x].kï¼Œä½†æ˜¯å®é™…ç®—æ³•æ˜¯æœ‰ä¼˜åŒ–çš„ï¼ŒSã€yã€k ä¸‰ä¸ªå€¼è¢«å­˜å…¥äº†åŒä¸€ä¸ª DWORD ä¸­ï¼Œç”¨ä½æ“ä½œä»£æ›¿äº†è¿™äº›æˆå‘˜å˜é‡è®¿é—®)</li>
  <li>è§£ç æ¶‰åŠåˆ°å¤šè½®è¿­ä»£ï¼Œæ¯è½®éƒ½ä¼šï¼š
    <ul>
      <li>æ ¹æ®å½“å‰çŠ¶æ€ä»é€ŸæŸ¥è¡¨æŸ¥å‡ºè§£ç çš„ç¬¦å· Sï¼ˆè§£å‹åå¾—åˆ°çš„åŸå§‹å€¼ï¼‰</li>
      <li>å°† x è½¬ç§»åˆ°æ–°çŠ¶æ€ï¼šçŠ¶æ€è½¬ç§»éœ€è¦ xã€yã€kã€bitStream å‚ä¸è¿ç®—</li>
    </ul>
  </li>
  <li>å›é¡¾ä¸€ä¸‹ Sequence Section çš„ç»“æ„ï¼š
    <ul>
      <li>
        <table>
          <tbody>
            <tr>
              <td><code class="language-plaintext highlighter-rouge">Sequences_Section_Header</code></td>
              <td>[<code class="language-plaintext highlighter-rouge">Literals_Length_Table</code>]</td>
              <td>[<code class="language-plaintext highlighter-rouge">Offset_Table</code>]</td>
              <td>[<code class="language-plaintext highlighter-rouge">Match_Length_Table</code>]</td>
              <td>bitStream</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>Xxxxx_Table å­˜å‚¨çš„å°±æ˜¯é€ŸæŸ¥è¡¨ï¼Œå› ä¸ºå­˜å‚¨äº† Literals_Lengthã€Offsetã€Match_Length ä¸‰ç§æ•°æ®ï¼Œæ‰€ä»¥æ˜¯ä¸‰ä¸ªé€ŸæŸ¥è¡¨</li>
      <li>bitStreamï¼Œå…¶å®æ˜¯ Literals_Lengthã€Offsetã€Match_Length ä¸‰ä¸ªæ•°æ®æµäº¤å‰å­˜æ”¾åœ¨ä¸€èµ·å½¢æˆçš„ä¸€ä¸ªæ•°æ®æµ</li>
    </ul>
  </li>
  <li>å¦å¤–è§£ç æ—¶ bitStream æ˜¯ä»æœ€åä¸€ä¸ªå­—èŠ‚å¼€å§‹ï¼Œåå‘ä½¿ç”¨çš„ã€‚å› ä¸ºç¼–ç æ—¶æ˜¯å°†çŠ¶æ€ä¿¡æ¯æ­£å‘å†™å…¥çš„ bitStreamï¼Œè§£ç çš„æ—¶å€™è¦ä»æœ€åä¸€ä¸ªçŠ¶æ€å¼€å§‹(ç¼–ç å™¨çœ¼é‡Œçš„æœ€åä¸€ä¸ªï¼‰ï¼Œåå‘æ¢å¤ï¼Œæ¢å¤å‡ºçš„åŸæ•°æ®ä¹Ÿæ˜¯åå‘çš„</li>
  <li>è‡³äºä¸ºä»€ä¹ˆè¿™æ ·è§£ç å¯ä»¥è§£å‹æ•°æ®ï¼Œxã€tabã€bitStreamã€yã€k åˆéƒ½æ˜¯æ€ä¹ˆæ¥çš„ï¼Œæ„Ÿå…´è¶£çš„è¯å¤§å®¶å¯ä»¥æ·±å…¥å»å­¦ä¹  tANS ç®—æ³•ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œåªéœ€è¦çŸ¥é“è¿™ä¸ªç®—æ³•çš„è§£ç å°±æ˜¯åœ¨åšè¿™äº›æ“ä½œå³å¯</li>
</ul>

<hr />
<p>â„¹ï¸ å¦‚æœæƒ³æ·±å…¥äº†è§£ tANS/FSEï¼Œå¦‚ä¸‹èµ„æ–™å¯ä»¥å‚è€ƒï¼š</p>
<ul>
  <li>https://www.cnblogs.com/zblade/p/14338758.html</li>
  <li>https://bjlkeng.io/posts/lossless-compression-with-asymmetric-numeral-systems/</li>
  <li>https://kedartatwawadi.github.io/postâ€“ANS/</li>
  <li>https://fastcompression.blogspot.com/2013/12/finite-state-entropy-new-breed-of.html</li>
  <li>http://cbloomrants.blogspot.fr/2014/02/02-18-14-understanding-ans-conclusion.html</li>
</ul>

<hr />

<p>äº†è§£äº†è¿™äº›ï¼Œå°±å¯ä»¥çŸ¥é“ï¼Œæ”»å‡»è€…å¯æ§çš„æ•°æ® <code class="language-plaintext highlighter-rouge">sym</code>ï¼Œå°±æ˜¯é€ŸæŸ¥è¡¨é‡Œå­˜å‚¨çš„å†…å®¹ï¼Œè§£ç çš„æ—¶å€™ç¡®å®ä¼šç”¨åˆ°å®ƒï¼Œä¸è¿‡è¿™é‡Œè¦æ³¨æ„é€ŸæŸ¥è¡¨é‡Œçš„å…ƒç´ æ˜¯ 32 æ¯”ç‰¹çš„ï¼Œè€Œæˆ‘ä»¬åªèƒ½æ§åˆ¶è¿™ 32 ä½çš„ä½ 8 ä½ï¼Œå†ç»“åˆä»£ç æ¥çœ‹ï¼Œ<code class="language-plaintext highlighter-rouge">Decompress_Sequences</code> å‡½æ•°ä¸­çš„ä¸´æ—¶å˜é‡ <code class="language-plaintext highlighter-rouge">state_ll</code>ã€<code class="language-plaintext highlighter-rouge">state_of</code>ã€<code class="language-plaintext highlighter-rouge">state_ml</code> æ˜¯ä»é€ŸæŸ¥è¡¨ä¸­æŸ¥åˆ°çš„å€¼ï¼Œå®ƒä»¬çš„æœ€ä½å­—èŠ‚åˆä¼šä¼ é€’åˆ° <code class="language-plaintext highlighter-rouge">of_code</code>ã€<code class="language-plaintext highlighter-rouge">matchLen</code>ã€<code class="language-plaintext highlighter-rouge">litLen</code>ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´é€ŸæŸ¥è¡¨å­˜å‚¨çš„ 32 æ¯”ç‰¹å…ƒç´ ï¼Œä½ 8 ä½å­˜æ”¾çš„æ˜¯ç¬¦å· Sï¼‰è€Œ <code class="language-plaintext highlighter-rouge">of_code</code>ã€<code class="language-plaintext highlighter-rouge">matchLen</code>ã€<code class="language-plaintext highlighter-rouge">litLen</code>ï¼Œåˆåœ¨å‡ å¤„å†…å­˜è®¿é—®çš„åœ°æ–¹è¢«å½“ä½œç´¢å¼•/é•¿åº¦æ¥ä½¿ç”¨ï¼Œå¦‚æœåœ¨è¿™äº›å†…å­˜è®¿é—®çš„åœ°æ–¹ï¼Œä¹Ÿæ²¡æœ‰æ£€æŸ¥ç´¢å¼•/é•¿åº¦çš„åˆç†æ€§çš„è¯ï¼Œå°±ä¼šäº§ç”Ÿå†…å­˜è®¿é—®è¶Šç•Œäº†ã€‚ä¾‹å¦‚:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//from ZstdDec.i.c
//...
static const UInt32 k_SEQ_LL_BASES[36] = {
    0,     1,     2,     3,     4,      5,      6,      7,      8,
    9,     10,    11,    12,    13,     14,     15,     16,     18,
    20,    22,    24,    28,    32,     40,     48,     64,     0x80,
    0x100, 0x200, 0x400, 0x800, 0x1000, 0x2000, 0x4000, 0x8000, 0x10000};
#line 286 ".\\ZstdDec.c"

static const Byte k_SEQ_LL_EXTRA[36] = {
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  0,  0,  0,  0,  1,  1,
    1, 1, 2, 2, 3, 3, 4, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16};

//....

const unsigned extra = k_SEQ_LL_EXTRA[litLen];
litLen = k_SEQ_LL_BASES[litLen];

</code></pre></div></div>

<hr />
<p>â„¹ï¸ ä¹Ÿå¯ä»¥é€šè¿‡é˜…è¯»åŸä»£ç ï¼Œåœ¨å®å®šä¹‰ä¸­å‘ç°é€ŸæŸ¥è¡¨ä¸­å­˜å‚¨çš„ä¿¡æ¯çš„æ ¼å¼ï¼š</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define FSE_REC_LEN_OFFSET    8
#define FSE_REC_STATE_OFFSET  16
#define GET_FSE_REC_SYM(st)   ((Byte)(st))
#define GET_FSE_REC_LEN(st)   ((Byte)((st) &gt;&gt; FSE_REC_LEN_OFFSET))
#define GET_FSE_REC_STATE(st) ((st) &gt;&gt; FSE_REC_STATE_OFFSET)
</span></code></pre></div></div>
<hr />

<p>ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">litLen</code> ä½œä¸ºä¸‹æ ‡è®¿é—®äº†ä¸¤ä¸ªæ•°ç»„ï¼Œä¸¤ä¸ªæ•°ç»„çš„é•¿åº¦éƒ½å°äº <code class="language-plaintext highlighter-rouge">litLen</code> å¯èƒ½çš„æœ€å¤§å–å€¼ï¼Œå¾ˆå¯èƒ½å¯ä»¥æ„é€ å‡ºèƒ½è§¦å‘è¶Šç•Œè¯»çš„æ ·æœ¬ã€‚</p>

<p>ä¸‹é¢æˆ‘ä»¬å°±ç»“åˆè°ƒè¯•å™¨ï¼Œæ„é€ å‡ºå¯¹åº”çš„æ ·æœ¬ï¼Œè§¦å‘è¶Šç•Œè®¿é—®ã€‚å…ˆä»æºç æ„å»ºå‡ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ•´ä¸ªé¡¹ç›®åŒ…å«å¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘é€‰æ‹©äº† 7zcl.exeã€7z.dll ä½œä¸ºè°ƒè¯•ç›®æ ‡ï¼Œç”¨ nmake æ¥æ„å»ºï¼Œæ„å»º Debug ç‰ˆæœ¬ä»¥æ–¹ä¾¿è°ƒè¯•ï¼Œæ–¹æ¡ˆæ˜¯å‚è€ƒ <a href="https://stackoverflow.com/questions/56436451/nmake-how-do-i-force-a-debug-build-7zip">stackoverflow nmake-how-do-i-force-a-debug-build-7zip</a> ã€‚</p>
<ul>
  <li>ä¿®æ”¹ CPP/7zip/UI/Client7z/Client7z.cpp:64 çš„ä»£ç  <code class="language-plaintext highlighter-rouge">DEFINE_GUID_ARC (CLSID_Format, 0xe)</code>
    <ul>
      <li>0xe æ˜¯ zstd æ–‡æ¡£å¯¹åº”çš„ arc ID</li>
      <li>å¯ä»¥åœ¨ CPP/7zip/Archive/ZstdHandler.cpp çš„ <code class="language-plaintext highlighter-rouge">REGISTER_ARC_IO</code> å®è°ƒç”¨ä¸­æ‰¾åˆ°</li>
    </ul>
  </li>
  <li>ä¿®æ”¹ CPP/Build.mak çš„ CFLAGS å’Œ LFLAGSï¼Œä»¥æ„å»ºè°ƒè¯•ç‰ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä»¥åŠå¯¹åº”çš„ .pdb æ–‡ä»¶ï¼š
    <ul>
      <li>CFLAGS ä¸­çš„ -O1 -O2 éƒ½æ”¹æˆ -Od ç¦ç”¨ä¼˜åŒ–</li>
      <li>CFLAGS åŠ å…¥ /Zi ä»¥ç”Ÿæˆè°ƒè¯•ç¬¦å·</li>
      <li>CFLAGS å»æ‰ -W4 å’Œ -Wallï¼Œä»¥è§£å†³ç¼–è¯‘è¿‡ç¨‹ä¸­ç”±äºè­¦å‘Šé€ æˆçš„ç¼–è¯‘å¤±è´¥</li>
      <li>LFLSGS åŠ å…¥ /DEBUG</li>
    </ul>
  </li>
  <li>åœ¨ VS Developer Powershell æ‰§è¡Œæ„å»ºæ“ä½œ
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="err">&gt;</span><span class="w"> </span><span class="n">pushd</span><span class="w">
  </span><span class="err">&gt;</span><span class="w"> </span><span class="c"># æ„å»ºclient7z.exe</span><span class="w">
  </span><span class="err">&gt;</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="nx">CPP\7zip\UI\Client7z</span><span class="w">
  </span><span class="err">&gt;</span><span class="w"> </span><span class="n">nmake</span><span class="w">
  </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">popd</span><span class="w">
  </span><span class="err">&gt;</span><span class="w"> </span><span class="c"># æ„å»º 7z.dll</span><span class="w">
  </span><span class="err">&gt;</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="nx">CPP\7zip\Bundles\Format7zF</span><span class="w">
  </span><span class="err">&gt;</span><span class="w"> </span><span class="n">nmake</span><span class="w">
  </span><span class="err">&gt;</span><span class="w"> </span><span class="c"># æ‹·è´ 7z.dll 7z.pdb åˆ° client7z.exe åŒç›®å½•</span><span class="w">
  </span><span class="err">&gt;</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="o">.</span><span class="nx">\o\7z.dll</span><span class="w"> </span><span class="o">..</span><span class="nx">\..\UI\Client7z\o\</span><span class="w">
  </span><span class="err">&gt;</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="o">.</span><span class="nx">\o\7z.pdb</span><span class="w"> </span><span class="o">..</span><span class="nx">\..\UI\Client7z\o\</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<p>æœ‰äº† Client7z.exe å’Œ 7z.dll å°±å¯ä»¥è°ƒè¯•äº†ï¼Œå¯¹äºæœ‰æºç çš„åœºæ™¯ï¼Œæˆ‘å–œæ¬¢ç”¨ VS æ¥è°ƒè¯•:</p>
<ul>
  <li>ç”¨ VS çš„ Open Folder åŠŸèƒ½å°† 7zip çš„æºç ç›®å½•ä½œä¸ºé¡¹ç›®æ‰“å¼€</li>
  <li>åœ¨ VS çš„è§£å†³æ–¹æ¡ˆæµè§ˆå™¨ï¼Œæ‰¾åˆ° Client7z.exe ï¼ˆåœ¨ CPP/7zip/UI/Client7z/o/Client7z.exe)</li>
  <li>å³é”®èœå• -&gt; Set As Startup Item</li>
  <li>å³é”®èœå• -&gt; Add Debug Configuration -&gt; Default</li>
  <li>åœ¨è‡ªåŠ¨æ‰“å¼€çš„ lauch.vs.json ä¸­åŠ å…¥å‘½ä»¤è¡Œé…ç½® <code class="language-plaintext highlighter-rouge">args</code>
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"defaults"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"project"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CPP</span><span class="se">\\</span><span class="s2">7zip</span><span class="se">\\</span><span class="s2">UI</span><span class="se">\\</span><span class="s2">Client7z</span><span class="se">\\</span><span class="s2">o</span><span class="se">\\</span><span class="s2">7zcl.exe"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"projectTarget"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7zcl.exe"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"args"</span><span class="p">:[</span><span class="s2">"7zcl.exe"</span><span class="p">,</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="s2">"poc.zst"</span><span class="p">],</span><span class="w"> 
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<p>è¿™æ ·é…ç½®å¥½ä»¥åï¼Œåœ¨ VS ä¸­ç‚¹å‡»å¼€å§‹è°ƒè¯•ï¼ŒVS å°±ä¼šç”¨æŒ‡å®šçš„å‘½ä»¤è¡Œä¸ºæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª 7zcl.exe å¹¶å¼€å§‹è°ƒè¯•äº†ã€‚å‚æ•°ä¸­æŒ‡å®šäº†ç”¨ 7zcl.exe æ¥è§£å‹ä¸€ä¸ª poc.zst æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ„é€ å‡ºè¿™ä¸ª poc æ–‡ä»¶ã€‚æˆ‘çš„æ„é€ æ–¹å¼æ˜¯æ‰¾åˆ°ä¸€ä¸ªå°çš„ .zst æ–‡ä»¶ï¼Œåœ¨å®ƒçš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚æ‰€ä»¥æˆ‘å®‰è£…äº†å‹ç¼©ç¨‹åº zstd å‹ç¼©äº†ä¸€ä¸ªéšä¾¿æ‰¾çš„å°æ–‡ä»¶ï¼Œå¾—åˆ°ä¸‹é¢è¿™ä¸ª poc.zst æ–‡æ¡£(base64 ç¼–ç çš„æ•°æ®)ã€‚</p>

<pre><code class="language-base64">KLUv/WSBAJ0HAFJNLiUgjegBs3wDbJDe4r8UR0hA5BmkXH0Jy6Cv+C63gaF/CdCKP4IGzBhJZOKUqtIw7n20LSBY3uBwWZSIl6jJcpCpKCCYttankcF0jCQycelqTFPTw5UYKgg9+Quz+k+L7D+0xU4we2fpP+lo+E9CaGFW3b/pbGySfuPgbfN4At3MIB0AoGin69MidMwSqMkZFESlIF1t4b5wb6c/QtDCf8wG2ulGNJ+E4CNaZ786OsHs3skrTTv9TBoFFQBCO8DJOEBhX52cCLeAtQPAymDVhpcMuG58YyM4JrMaHiov0xxbDWxBoGAlONs9w+AyrI8oe8zKBHY=
</code></pre>

<hr />
<p>â„¹ï¸ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ª <a href="https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)&amp;input=S0xVdi9XU0JBSjBIQUZKTkxpVWdqZWdCczN3RGJKRGU0cjhVUjBoQTVCbWtYSDBKeTZDditDNjNnYUYvQ2RDS1A0SUd6QmhKWk9LVXF0SXc3bjIwTFNCWTN1QndXWlNJbDZqSmNwQ3BLQ0NZdHRhbmtjRjBqQ1F5Y2VscVRGUFR3NVVZS2dnOStRdXoraytMN0QrMHhVNHdlMmZwUCtsbytFOUNhR0ZXM2IvcGJHeVNmdVBnYmZONEF0M01JQjBBb0dpbjY5TWlkTXdTcU1rWkZFU2xJRjF0NGI1d2I2Yy9RdERDZjh3RzJ1bEdOSitFNENOYVo3ODZPc0hzM3NrclRUdjlUQm9GRlFCQ084REpPRUJoWDUyY0NMZUF0UVBBeW1EVmhwY011RzU4WXlNNEpyTWFIaW92MHh4YkRXeEJvR0FsT05zOXcrQXlySThvZTh6S0JIWT0&amp;oeol=VT">CyberChef é¡µé¢</a>ä¸‹è½½ .zst æ–‡æ¡£</p>

<hr />

<p>æ¥ä¸‹æ¥æˆ‘è°ƒè¯•äº† Client7z.exe è§£å‹ poc.zst çš„è¿‡ç¨‹ï¼Œå‘ç° poc.zst çš„ Symbol compression modes (0xC7 åç§»å¤„)  å…¨ä¸º 0ã€‚
<img src="/assets/images/Pasted image 20241210144512.png" alt="" /></p>

<p>ä¸ºäº†è§¦å‘æ¼æ´ï¼Œæˆ‘æŠŠä»–æ”¹æˆ <code class="language-plaintext highlighter-rouge">0b01010100</code>ï¼Œå†æŠŠåé¢ 3 å­—èŠ‚çš„æ•°æ®å…¨æ”¹æˆ <code class="language-plaintext highlighter-rouge">0xff</code>ã€‚</p>

<p><img src="/assets/images/Pasted image 20241210145918.png" alt="" /></p>

<p>æ”¹å®Œåå†æ¬¡è°ƒè¯•ï¼Œå‘ç°å·²ç»å¯ä»¥è§¦å‘è¶Šç•Œè¯»ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ZstdDec.c:2197</span>
<span class="kt">size_t</span> <span class="n">litLen</span> <span class="o">=</span> <span class="n">GET_FSE_REC_SYM</span><span class="p">(</span><span class="n">STATE_VAR</span><span class="p">(</span><span class="n">ll</span><span class="p">));</span>
<span class="k">if</span> <span class="p">(</span><span class="n">litLen</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// if (STATE_VAR(ll) &amp; 0x70)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">litLen</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">)</span>
  <span class="p">{</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">BASES_TABLE</span><span class="p">(</span><span class="n">SEQ_LL_EXTRA</span><span class="p">)</span> <span class="p">[</span><span class="n">litLen</span><span class="p">];</span> <span class="c1">// è¿è¡Œåˆ°è¿™é‡Œ litLen ä¸º 0xff å·²ç»è¶…å‡ºäº† k_SEQ_LL_EXTRA æ•°ç»„çš„è¾¹ç•Œ</span>
	<span class="n">litLen</span> <span class="o">=</span> <span class="n">BASES_TABLE</span><span class="p">(</span><span class="n">SEQ_LL_BASES</span><span class="p">)</span> <span class="p">[</span><span class="n">litLen</span><span class="p">];</span> <span class="c1">// è¿™é‡Œä¹Ÿæ˜¯</span>
	<span class="cp">#ifdef Z7_ZSTD_DEC_USE_64BIT_LOADS
</span></code></pre></div></div>

<p>è™½ç„¶å¯ä»¥è§¦å‘æ¼æ´äº†ï¼Œä½†æ˜¯ç”±äºè¿™ä¸¤ä¸ªæ•°ç»„éƒ½æ˜¯ static æ•°ç»„ï¼Œå­˜å‚¨åœ¨ 7z.dll çš„ .rdata æ®µçš„ï¼Œè¶Šç•Œè¯»åˆšå¥½å¯ä»¥è¯»åˆ°å…¶ä»–åªè¯»æ•°æ®ï¼Œä¸ä¼šè§¦å‘å´©æºƒï¼Œä¸€ä¸ªä¸ä¼šè§¦å‘å´©æºƒçš„ POCï¼Œæ€»æ„Ÿè§‰å·®ç‚¹ä»€ä¹ˆï¼Œè€Œä¸”å…¬å‘Šé‡Œè¯´è¿™ä¸ªæ¼æ´æ˜¯å¯ä»¥é€ æˆä¸€ä¸ª underflow çš„ï¼Œå’Œæˆ‘ä»¬åˆ†æçš„æƒ…å†µä¹Ÿæ˜æ˜¾ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­åˆ†æçœ‹æ€ä¹ˆæ‰èƒ½è§¦å‘å´©æºƒ/ underflowã€‚</p>

<p><strong>æœªå®Œå¾…ç»­</strong></p>

<h2 id="typo">Typo</h2>

<p>åˆ†ææ¼æ´çš„è¿‡ç¨‹ä¸­è¿˜åœ¨ 7z é¡¹ç›®ä¸­å‘ç°ä¸€ä¸ª typoï¼Œæœ‰ç©ºå»åˆ·ä¸€ä¸ª COMMIT ğŸ™ƒ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// CPP/7zip/Archive/ArchiveExports.cpp:50 
static int FindFormatCalssId(const GUID *clsid) // Calss -&gt; Class
</code></pre></div></div>

  </div><div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = '';
      this.page.identifier = 'https://pwntips.github.io/2024/12/10/7zip-CVE-2024-11477.html';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://PwnTips.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/2024/12/10/7zip-CVE-2024-11477.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://pwntips.github.io/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Tips &amp; Tricks</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
